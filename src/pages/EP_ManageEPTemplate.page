<apex:page standardController="Engagement_Plan_Template__c" extensions="EP_ManageEPTemplate_CTRL" standardStylesheets="false" showHeader="true">
    <apex:stylesheet value="{!URLFOR($Resource.sfdo203, '/assets/styles/salesforce-lightning-design-system-vf.min.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.CumulusStaticResources, '/npsp-slds/npsp-common.css')}" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <apex:form id="theForm">
        <div class="sfdo203">
            <div class="slds-spinner_container" style="z-index:999;position:fixed;display:none;" id="divLoading">
                <div class="slds-spinner--brand slds-spinner slds-spinner--medium" style="position:fixed;top:30%;" aria-hidden="false" role="alert">
                    <div class="slds-spinner__dot-a"></div>
                    <div class="slds-spinner__dot-b"></div>
                </div>
            </div>
            <!-- PAGE HEADER -->
            <div class="slds-page-header" role="banner">
              <div class="slds-grid">
                <div class="slds-col">
                  <p class="slds-text-heading--medium">Manage Engagement Plan Template</p>
                  <!--h1 class="slds-text-heading- -medium">My Expenses</h1-->
                </div>
                <div class="slds-col slds-no-flex slds-align-middle">
                    <div class="slds-button-group" role="group">
                        <apex:commandButton id="saveCloseBTN" styleClass="slds-button slds-button--brand" action="{!saveClose}" value="{!$Label.stgBtnSave}" immediate="false"/>
                        <apex:commandButton id="cancelBTN" styleClass="slds-button slds-button--neutral" action="{!cancel}" value="{!$Label.stgBtnCancel}"  immediate="true"/>
                    </div>
                </div>
              </div>
            </div>
            <!-- / PAGE HEADER -->
            
            <apex:outputPanel id="panelErrors">
                <c:UTIL_PageMessages html-class="slds-grid slds-grid--align-center slds-m-bottom--small"/>
            </apex:outputPanel>

            <!-- TEMPLATE VIEW -->
            <form class="slds-form slds-form--horizontal">
                <apex:outputPanel styleClass="slds-grid" id="templateForm">
                    <div class="slds-col slds-col--padded slds-p-top--large slds-size--1-of-2">
                        <div class="slds-form-element slds-p-top--small slds-is-required">
                            <apex:outputLabel value="{!$ObjectType.Engagement_Plan_Template__c.Fields.Name.Label}" for="idName" styleClass="slds-form-element__label" />
                            <div class="slds-form-element__control">
                                <apex:inputField id="idName" styleClass="slds-input" value="{!template.Name}" required="true"/>
                            </div>
                        </div>
                        <div class="slds-form-element slds-p-top--small slds-is-required">
                            <apex:outputLabel value="{!$ObjectType.Engagement_Plan_Template__c.Fields.Description__c.Label}" for="idDesc" styleClass="slds-form-element__label" />
                            <div class="slds-form-element__control">
                                <apex:inputField id="idDesc" styleClass="slds-input" value="{!template.Description__c}"/>
                            </div>
                        </div>
                    </div>
                    <div class="slds-col slds-col--padded slds-p-top--large slds-size--1-of-2">
                        <div class="slds-form-element slds-p-top--small slds-is-required">
                            <apex:outputLabel value="{!$ObjectType.Engagement_Plan_Template__c.Fields.Default_Assignee__c.Label}" for="idBlankAssignmentRule" styleClass="slds-form-element__label" />
                            <div class="slds-form-element__control">
                                <apex:inputField id="idBlankAssignmentRule" styleClass="slds-select slds-input" value="{!template.Default_Assignee__c}" required="true"/>
                            </div>
                            <apex:outputText styleClass="slds-form-element__help" value="{!$ObjectType.Engagement_Plan_Template__c.Fields.Default_Assignee__c.inlinehelpText}" />
                        </div>
                        <div class="slds-form-element slds-p-top--small">
                            <div class="slds-form-element__control">
                                <label class="slds-checkbox">
                                    <apex:inputCheckbox id="idSkipWeekends" value="{!template.Skip_Weekends__c}">
                                        <apex:actionSupport event="onchange" immediate="false" reRender="templateForm" status="statusLoad"/>
                                    </apex:inputCheckbox>
                                    <span class="slds-checkbox--faux"></span>
                                    <apex:outputPanel styleClass="slds-form-element__label">{!$ObjectType.Engagement_Plan_Template__c.Fields.Skip_Weekends__c.Label}</apex:outputPanel>
                                </label>
                            </div>
                            <apex:outputText styleClass="slds-form-element__help" value="{!$ObjectType.Engagement_Plan_Template__c.Fields.Skip_Weekends__c.inlinehelpText}" />
                        </div>
                        <apex:outputPanel rendered="{!template.Skip_Weekends__c==true}" layout="block" styleClass="slds-form-element slds-p-top--small slds-is-required">
                            <apex:outputLabel value="{!$ObjectType.Engagement_Plan_Template__c.Fields.Reschedule_To__c.Label}" for="idSkipDay" styleClass="slds-form-element__label" />
                            <div class="slds-form-element__control">
                                <apex:inputField id="idSkipDay" styleClass="slds-select slds-input" value="{!template.Reschedule_To__c}"/>
                            </div>
                            <apex:outputText styleClass="slds-form-element__help" value="{!$ObjectType.Engagement_Plan_Template__c.Fields.Reschedule_To__c.inlinehelpText}" />
                        </apex:outputPanel>
                        <div class="slds-form-element slds-p-top--small">
                            <div class="slds-form-element__control">
                                <label class="slds-checkbox">
                                    <apex:inputCheckbox id="idUpdateDueDate" styleClass="slds-checkbox" value="{!template.Automatically_Update_Child_Task_Due_Date__c}" />
                                    <span class="slds-checkbox--faux"></span>
                                
                                    <apex:outputLabel value="{!$ObjectType.Engagement_Plan_Template__c.Fields.Automatically_Update_Child_Task_Due_Date__c.Label}" for="idUpdateDueDate" styleClass="slds-form-element__label" />
                                </label>
                            </div>
                            <apex:outputText styleClass="slds-form-element__help" value="{!$ObjectType.Engagement_Plan_Template__c.Fields.Automatically_Update_Child_Task_Due_Date__c.inlinehelpText}" />
                        </div>
                    </div>
                </apex:outputPanel>
            </form>
            <p class="slds-text-heading--medium">Manage Engagement Plan Tasks</p>
            <apex:outputPanel layout="block" styleClass="slds-grid" id="taskTree">
                <div class="slds-col slds-m-top--medium slds-m-right--medium slds-size--1-of-1">
                    <apex:dynamicComponent componentValue="{!taskTree}"/>
                </div>
            </apex:outputPanel>
        </div>
        <apex:actionFunction name="addDependentTaskJS" action="{!addDependentTask}" immediate="false" status="statusLoad" reRender="taskTree">
            <apex:param name="depentendTaskParam" value="" assignTo="{!currentTaskLevel}" />
        </apex:actionFunction>
        <apex:actionFunction name="deleteTaskJS" action="{!deleteTask}" immediate="false" status="statusLoad" reRender="taskTree">
            <apex:param name="deleteTaskParam" value="" assignTo="{!currentTaskLevel}" />
        </apex:actionFunction>
        <apex:actionFunction name="updateTemplateForm" immediate="false" status="statusLoad" reRender="theForm" />
        <!--spinner status-->
        <apex:actionStatus id="statusLoad"
                    onstart="document.getElementById('divLoading').style.display = 'block';console.log('started');"
                    onstop="document.getElementById('divLoading').style.display = 'none';console.log('done');" />
    </apex:form>
</apex:page>